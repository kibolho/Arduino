/* IRremoteESP8266: IRsendDemo - demonstrates sending IR codes with IRsend.
 *
 * Version 1.0 April, 2017
 * Based on Ken Shirriff's IrsendDemo Version 0.1 July, 2009,
 * Copyright 2009 Ken Shirriff, http://arcfn.com
 *
 * An IR LED circuit *MUST* be connected to the ESP8266 on a pin
 * as specified by IR_LED below.
 *
 * TL;DR: The IR LED needs to be driven by a transistor for a good result.
 *
 * Suggested circuit:
 *     https://github.com/markszabo/IRremoteESP8266/wiki#ir-sending
 *
 * Common mistakes & tips:
 *   * Don't just connect the IR LED directly to the pin, it won't
 *     have enough current to drive the IR LED effectively.
 *   * Make sure you have the IR LED polarity correct.
 *     See: https://learn.sparkfun.com/tutorials/polarity/diode-and-led-polarity
 *   * Typical digital camera/phones can be used to see if the IR LED is flashed.
 *     Replace the IR LED with a normal LED if you don't have a digital camera
 *     when debugging.
 *   * Avoid using the following pins unless you really know what you are doing:
 *     * Pin 0/D3: Can interfere with the boot/program mode & support circuits.
 *     * Pin 1/TX/TXD0: Any serial transmissions from the ESP8266 will interfere.
 *     * Pin 3/RX/RXD0: Any serial transmissions to the ESP8266 will interfere.
 *   * ESP-01 modules are tricky. We suggest you use a module with more GPIOs
 *     for your first time. e.g. ESP-12 etc.
 */

#ifndef UNIT_TEST
#include <Arduino.h>
#endif
#include <IRremoteESP8266.h>
#include <IRsend.h>

#define IR_LED 16  // ESP8266 GPIO pin to use. Recommended: 4 (D2).
#define RELAY_PIN 5  // ESP8266 GPIO pin to use. Recommended: 4 (D2).

IRsend irsend(IR_LED);  // Set the GPIO to be used to sending the message.

// Example of data captured by IRrecvDumpV2.ino
//uint16_t rawData[347]={9012, 4508, 568, 552, 592, 568, 544, 552, 568, 1684, 564, 1684, 564, 552, 568, 556, 564, 552, 568, 552, 568, 552, 564, 556, 564, 556, 564, 556, 588, 548, 564, 556, 564, 1684, 564, 556, 564, 556, 564, 552, 568, 552, 564, 552, 568, 556, 564, 556, 564, 552, 568, 552, 592, 544, 568, 576, 544, 552, 564, 556, 564, 552, 568, 556, 564, 576, 544, 1680, 568, 552, 568, 576, 544, 552, 568, 572, 572, 1672, 568, 552, 568, 576, 544, 552, 568, 552, 564, 556, 564, 576, 544, 552, 568, 552, 568, 572, 544, 552, 568, 1684, 592, 544, 568, 552, 568, 1684, 564, 1680, 568, 1684, 564, 552, 568, 1684, 564, 13508, 9048, 4504, 568, 556, 564, 556, 564, 552, 568, 1680, 568, 1684, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 592, 568, 544, 552, 568, 552, 564, 556, 564, 556, 564, 1680, 568, 576, 544, 576, 544, 552, 568, 552, 568, 576, 540, 556, 592, 544, 568, 552, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 564, 556, 564, 556, 564, 576, 544, 1684, 564, 552, 596, 544, 564, 552, 568, 556, 564, 1684, 564, 556, 564, 552, 568, 556, 564, 576, 544, 552, 568, 552, 564, 576, 544, 552, 592, 568, 544, 556, 564, 1684, 564, 552, 568, 556, 564, 1680, 568, 1684, 564, 1684, 564, 556, 564, 1680, 596, 13504, 8992, 4504, 568, 556, 592, 544, 564, 556, 564, 1684, 564, 1684, 568, 552, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 568, 552, 564, 556, 592, 544, 568, 552, 564, 1684, 568, 552, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 564, 556, 568, 572, 544, 556, 592, 540, 568, 556, 564, 556, 564, 556, 564, 552, 568, 552, 564, 556, 564, 1684, 568, 552, 564, 556, 564, 552, 568, 556, 588, 1676, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 564, 556, 564, 576, 544, 576, 544, 1680, 596, 544, 564, 556, 564, 1684, 568, 1680, 568, 1684, 564, 556, 564, 1684, 564,};
//Desligar
uint16_t S_off[347]={9048, 4504, 592, 532, 568, 552, 564, 576, 568, 1656, 568, 1684, 588, 528, 572, 552, 564, 576, 544, 1684, 564, 576, 580, 1664, 568, 1704, 544, 576, 544, 1680, 568, 556, 588, 528, 568, 576, 568, 552, 544, 552, 564, 556, 564, 556, 564, 576, 568, 548, 564, 552, 576, 544, 568, 576, 544, 572, 544, 556, 564, 576, 544, 556, 564, 576, 544, 576, 544, 1676, 572, 572, 596, 520, 592, 552, 544, 552, 588, 1660, 568, 576, 544, 576, 544, 576, 564, 552, 544, 552, 592, 552, 568, 552, 544, 552, 592, 544, 568, 576, 544, 576, 568, 1680, 568, 1656, 592, 552, 568, 552, 568, 1680, 572, 1676, 572, 548, 596, 13476, 9040, 4480, 600, 548, 596, 516, 596, 528, 588, 1656, 596, 1676, 572, 548, 572, 548, 572, 548, 568, 1660, 592, 524, 592, 1656, 596, 1656, 592, 548, 596, 1648, 596, 548, 568, 528, 592, 552, 568, 548, 572, 524, 592, 552, 568, 552, 568, 552, 544, 552, 592, 548, 572, 548, 596, 520, 588, 552, 568, 528, 592, 528, 592, 552, 568, 552, 564, 528, 592, 1680, 548, 572, 544, 552, 592, 552, 568, 528, 592, 1676, 588, 532, 564, 576, 544, 576, 548, 548, 568, 552, 588, 556, 540, 576, 544, 552, 568, 552, 592, 552, 544, 572, 572, 1672, 592, 1656, 596, 548, 544, 576, 568, 1660, 592, 1656, 592, 552, 568, 13460, 9068, 4480, 596, 548, 572, 552, 568, 548, 572, 1676, 572, 1652, 596, 552, 568, 548, 572, 548, 568, 1656, 592, 528, 620, 1648, 596, 1648, 600, 524, 596, 1676, 572, 548, 572, 524, 592, 548, 572, 552, 568, 528, 592, 524, 596, 548, 568, 528, 620, 540, 572, 548, 568, 552, 568, 528, 592, 524, 596, 548, 572, 548, 572, 524, 592, 528, 592, 552, 568, 1680, 568, 524, 624, 540, 572, 548, 568, 528, 592, 1680, 568, 552, 568, 528, 592, 528, 592, 524, 596, 548, 572, 520, 600, 548, 568, 552, 596, 540, 568, 524, 596, 548, 572, 1652, 596, 1656, 596, 548, 568, 552, 568, 1680, 568, 1680, 572, 524, 620,};
//Padrao sinal RAW Ligar Ar Condicionado Consul 25oC
uint16_t S_pwr25[347]={9012, 4508, 564, 556, 592, 544, 568, 552, 564, 1684, 564, 1688, 564, 576, 544, 572, 544, 556, 564, 1684, 564, 576, 544, 1684, 568, 1684, 564, 576, 568, 1696, 544, 556, 568, 1680, 564, 576, 544, 556, 564, 576, 544, 576, 544, 576, 544, 576, 540, 580, 540, 580, 540, 556, 592, 564, 544, 576, 544, 576, 544, 576, 544, 552, 568, 576, 540, 580, 540, 1684, 568, 552, 568, 572, 544, 576, 544, 556, 588, 1696, 548, 552, 564, 580, 540, 576, 544, 576, 544, 576, 544, 576, 544, 576, 540, 556, 564, 576, 544, 576, 544, 556, 588, 1680, 560, 1688, 564, 576, 540, 556, 564, 1708, 544, 1684, 564, 1684, 564, 13516, 9036, 4508, 568, 556, 564, 576, 544, 576, 544, 1680, 568, 1684, 564, 576, 544, 576, 544, 576, 544, 1704, 544, 576, 568, 1676, 564, 1684, 568, 552, 568, 1680, 568, 556, 564, 1704, 544, 576, 544, 576, 544, 552, 568, 572, 544, 552, 568, 556, 592, 564, 544, 556, 564, 552, 568, 576, 544, 552, 568, 576, 544, 572, 548, 552, 564, 576, 544, 576, 544, 1684, 564, 556, 592, 544, 564, 576, 544, 576, 548, 1676, 568, 556, 564, 556, 564, 576, 544, 576, 544, 552, 564, 576, 544, 576, 544, 556, 588, 544, 568, 576, 544, 552, 568, 1684, 564, 1680, 568, 556, 564, 576, 544, 1704, 544, 1684, 568, 1680, 596, 13476, 9016, 4508, 568, 576, 568, 544, 568, 576, 540, 1684, 568, 1704, 544, 576, 544, 576, 544, 552, 564, 1708, 544, 556, 564, 1680, 568, 1680, 568, 576, 568, 1676, 568, 576, 540, 1684, 568, 576, 544, 576, 544, 552, 564, 556, 564, 552, 568, 552, 568, 572, 548, 576, 540, 576, 572, 544, 568, 552, 568, 552, 564, 576, 544, 552, 568, 576, 540, 576, 544, 1684, 568, 552, 564, 580, 540, 576, 544, 576, 572, 1676, 564, 576, 544, 552, 568, 572, 544, 576, 544, 576, 544, 576, 544, 576, 544, 576, 540, 576, 544, 556, 564, 576, 568, 1676, 568, 1704, 544, 576, 544, 556, 564, 1684, 564, 1684, 564, 1684, 564,};
//Padrao sinal RAW Ligar Ar Condicionado Consul 18oC
uint16_t S_pwr18[347]={9012, 4508, 568, 552, 592, 568, 544, 552, 568, 1684, 564, 1684, 564, 552, 568, 556, 564, 552, 568, 552, 568, 552, 564, 556, 564, 556, 564, 556, 588, 548, 564, 556, 564, 1684, 564, 556, 564, 556, 564, 552, 568, 552, 564, 552, 568, 556, 564, 556, 564, 552, 568, 552, 592, 544, 568, 576, 544, 552, 564, 556, 564, 552, 568, 556, 564, 576, 544, 1680, 568, 552, 568, 576, 544, 552, 568, 572, 572, 1672, 568, 552, 568, 576, 544, 552, 568, 552, 564, 556, 564, 576, 544, 552, 568, 552, 568, 572, 544, 552, 568, 1684, 592, 544, 568, 552, 568, 1684, 564, 1680, 568, 1684, 564, 552, 568, 1684, 564, 13508, 9048, 4504, 568, 556, 564, 556, 564, 552, 568, 1680, 568, 1684, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 592, 568, 544, 552, 568, 552, 564, 556, 564, 556, 564, 1680, 568, 576, 544, 576, 544, 552, 568, 552, 568, 576, 540, 556, 592, 544, 568, 552, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 564, 556, 564, 556, 564, 576, 544, 1684, 564, 552, 596, 544, 564, 552, 568, 556, 564, 1684, 564, 556, 564, 552, 568, 556, 564, 576, 544, 552, 568, 552, 564, 576, 544, 552, 592, 568, 544, 556, 564, 1684, 564, 552, 568, 556, 564, 1680, 568, 1684, 564, 1684, 564, 556, 564, 1680, 596, 13504, 8992, 4504, 568, 556, 592, 544, 564, 556, 564, 1684, 564, 1684, 568, 552, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 568, 552, 564, 556, 592, 544, 568, 552, 564, 1684, 568, 552, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 564, 556, 568, 572, 544, 556, 592, 540, 568, 556, 564, 556, 564, 556, 564, 552, 568, 552, 564, 556, 564, 1684, 568, 552, 564, 556, 564, 552, 568, 556, 588, 1676, 568, 552, 564, 556, 564, 556, 564, 552, 568, 552, 568, 552, 568, 552, 564, 556, 564, 576, 544, 576, 544, 1680, 596, 544, 564, 556, 564, 1684, 568, 1680, 568, 1684, 564, 556, 564, 1684, 564,};

#include <ESP8266WiFi.h>
#include "fauxmoESP.h"


#define WIFI_SSID "Varoes"
#define WIFI_PASS "luanabilio"
#define SERIAL_BAUDRATE                 115200
 
fauxmoESP fauxmo;
 
// -----------------------------------------------------------------------------
// Wifi
// -----------------------------------------------------------------------------
 
void wifiSetup() {
 
    // Set WIFI module to STA mode
    WiFi.mode(WIFI_STA);
 
    // Connect
    Serial.printf("[WIFI] Connecting to %s ", WIFI_SSID);
    WiFi.begin(WIFI_SSID, WIFI_PASS);
 
    // Wait
    while (WiFi.status() != WL_CONNECTED) {
        Serial.print(".");
        delay(100);
    }
    Serial.println();
 
    // Connected!
    Serial.printf("[WIFI] STATION Mode, SSID: %s, IP address: %s\n", WiFi.SSID().c_str(), WiFi.localIP().toString().c_str());
}
 
void callback(uint8_t device_id, const char * device_name, bool state) {
  Serial.print("Device "); Serial.print(device_name);
  Serial.print(" state: ");
  if (state) {
    Serial.println("ON");
    irsend.sendRaw(S_off, 347, 38);  // Send a raw data capture at 38kHz.
  } else {
    Serial.println("OFF");
    irsend.sendRaw(S_pwr18, 347, 38);
  }
}
 
void setup() {
    irsend.begin();
    pinMode(RELAY_PIN, OUTPUT);
    // Init serial port and clean garbage
    Serial.begin(SERIAL_BAUDRATE);
    Serial.println("FauxMo demo sketch");
    Serial.println("After connection, ask Alexa/Echo to 'turn <devicename> on' or 'off'");
 
    // Wifi
    wifiSetup();
 
    // Fauxmo
    fauxmo.addDevice("air");
    //fauxmo.addDevice("pixels");
    fauxmo.onMessage(callback);
}
 
void loop() {
  fauxmo.handle();
}
